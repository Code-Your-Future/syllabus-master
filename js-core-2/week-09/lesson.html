
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Week 9 - AJAX, Async, Promises Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../js-core-3/" />
    
    
    <link rel="prev" href="../week-08/lesson.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Overview
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../others/lesson0.html">
            
                <a href="../../others/lesson0.html">
            
                    
                    Week 0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../html-css/">
            
                <a href="../../html-css/">
            
                    
                    HTML/CSS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../html-css/week-01/lesson.html">
            
                <a href="../../html-css/week-01/lesson.html">
            
                    
                    Week 1 - Semantic HTML and CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../html-css/week-02/lesson.html">
            
                <a href="../../html-css/week-02/lesson.html">
            
                    
                    Week 2 - Responsive Web and layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../html-css/week-03/lesson.html">
            
                <a href="../../html-css/week-03/lesson.html">
            
                    
                    Week 3 - Design frameworks, Naming patterns and Forms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../html-css/compile-scss-instructions.html">
            
                <a href="../../html-css/compile-scss-instructions.html">
            
                    
                    Compiling SCSS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../js-core/">
            
                <a href="../../js-core/">
            
                    
                    JavaScript I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../js-core/week-04/lesson.html">
            
                <a href="../../js-core/week-04/lesson.html">
            
                    
                    Week 4 - Hello JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../js-core/week-05/lesson.html">
            
                <a href="../../js-core/week-05/lesson.html">
            
                    
                    Week 5 - Arrays and Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../js-core/week-06/lesson.html">
            
                <a href="../../js-core/week-06/lesson.html">
            
                    
                    Week 6 - Debugging and more Data Structures
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../">
            
                <a href="../">
            
                    
                    JavaScript II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../week-07/lesson.html">
            
                <a href="../week-07/lesson.html">
            
                    
                    Week 7 - In-depth Functions and Intro to DOM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../week-08/lesson.html">
            
                <a href="../week-08/lesson.html">
            
                    
                    Week 8 - DOM, Events
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.3" data-path="lesson.html">
            
                <a href="lesson.html">
            
                    
                    Week 9 - AJAX, Async, Promises
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../js-core-3/">
            
                <a href="../../js-core-3/">
            
                    
                    JavaScript III
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../js-core-3/week-10/lesson.html">
            
                <a href="../../js-core-3/week-10/lesson.html">
            
                    
                    Week 10 - Good Code, TDD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../js-core-3/week-11/lesson.html">
            
                <a href="../../js-core-3/week-11/lesson.html">
            
                    
                    Week 11 - More TDD, ES6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../js-core-3/week-12/lesson.html">
            
                <a href="../../js-core-3/week-12/lesson.html">
            
                    
                    Week 12 - Exam maybe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../node-db/">
            
                <a href="../../node-db/">
            
                    
                    Node/DB I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../node-db/week-13/lesson.html">
            
                <a href="../../node-db/week-13/lesson.html">
            
                    
                    Week 13 - Node and Express 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../node-db/week-14/lesson.html">
            
                <a href="../../node-db/week-14/lesson.html">
            
                    
                    Week 14 - Templating and APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../node-db/week-15/lesson.html">
            
                <a href="../../node-db/week-15/lesson.html">
            
                    
                    Week 15 - Node and Mongo maybe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../node-db-2/">
            
                <a href="../../node-db-2/">
            
                    
                    Node/DB II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../node-db-2/week-16/lesson.html">
            
                <a href="../../node-db-2/week-16/lesson.html">
            
                    
                    Week 16 - MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../../node-db-2/week-17/lesson.html">
            
                <a href="../../node-db-2/week-17/lesson.html">
            
                    
                    Week 17 - Mongoose
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../../node-db-2/week-18/lesson.html">
            
                <a href="../../node-db-2/week-18/lesson.html">
            
                    
                    Week 18 - Node/DB Recap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../react/">
            
                <a href="../../react/">
            
                    
                    React
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../react/week-19/lesson.html">
            
                <a href="../../react/week-19/lesson.html">
            
                    
                    Week 19 - React 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../../react/week-20/lesson.html">
            
                <a href="../../react/week-20/lesson.html">
            
                    
                    Week 20 - State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../../react/week-21/lesson.html">
            
                <a href="../../react/week-21/lesson.html">
            
                    
                    Week 21 - React-router & Recap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../others/">
            
                <a href="../../others/">
            
                    
                    Others
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../../others/aws-workshop-2.html">
            
                <a href="../../others/aws-workshop-2.html">
            
                    
                    AWS - DynamoDB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../others/coding-101.html">
            
                <a href="../../others/coding-101.html">
            
                    
                    Coding 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../../house-rules.html">
            
                <a href="../../house-rules.html">
            
                    
                    House Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../../PRACTICES.html">
            
                <a href="../../PRACTICES.html">
            
                    
                    Coding Standards and Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../../CONTRIBUTING.html">
            
                <a href="../../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../../lesson-template.html">
            
                <a href="../../lesson-template.html">
            
                    
                    Lesson Template
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Week 9 - AJAX, Async, Promises</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="javascript-core-5">JavaScript Core 5</h1>
<p><img src="https://img.shields.io/badge/status-draft-darkred.svg" alt=""></p>
<p><strong>What will we learn today?</strong></p>
<ul>
<li><a href="#callbacks">Callbacks</a></li>
<li><a href="#asynchronous%20functions">Asynchronous functions</a></li>
<li><a href="#promises">Promises</a></li>
</ul>
<h2 id="callbacks">Callbacks</h2>
<ul>
<li><a href="http://javascriptissexy.com/understand-javascript-callback-functions-and-use-them/" target="_blank">Understand JavaScript Callback Functions and Use Them</a></li>
<li><a href="https://medium.freecodecamp.com/javascript-callbacks-explained-using-minions-da272f4d9bcd#.83dht6ta8" target="_blank">JavaScript Callbacks Explained Using Minions </a></li>
</ul>
<p>Callbacks are functions, that are called once another function has completed.
They are used to allow you code to run in the background (asynchronously).</p>
<p>We have already seen an example of this when working with APIs. The
<code>request.onreadystatechange</code> is a callback function.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">finished</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;The task has finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">thingThatTakesALongTime</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//... Task that takes a long time to complete</span>

  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// This is where the &apos;alert&apos; happens</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Pass the function to &apos;thingThatTakesALongTime&apos; just like a normal variable</span>
<span class="token function">thingThatTakesALongTime</span><span class="token punctuation">(</span>finished<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Sometimes callbacks are used, so you can handle errors separately.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span>problem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;There was an error: &quot;</span> <span class="token operator">+</span> problem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">errorCallback</span><span class="token punctuation">(</span><span class="token string">&quot;X is not 0!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">task</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Causes an alert to appear</span>
<span class="token function">task</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Returns 101</span>
</code></pre>
<h2 id="asynchronous-functions">Asynchronous functions</h2>
<ul>
<li><a href="http://www.w3schools.com/jsref/met_win_settimeout.asp" target="_blank">w3schools</a></li>
</ul>
<p>So far everything you have been doing has been synchronous. This means your code
is executed one line at a time, in order. Asynchronous code is not executed in
order, and can run at any time, in any order.</p>
<p>An example of this in real life, are phone calls and text messages.</p>
<ul>
<li>Phone calls are <code>synchronous</code> because you cant (really) do anything while the
other person is speaking. You are always waiting for your turn to respond</li>
<li>Text messages are <code>asynchronous</code>. When you send a text, you can go away and do
something else, until the other person responds.</li>
</ul>
<p>A simple example is <code>setTimeout</code>. This allows you to run a function after a
given time period. The first argument is the function you want to run, the
second argument is the <code>delay</code> (in milliseconds)</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>myFunction<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Goodbye world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Exercise:</p>
<ol>
<li>Go through this tutorial: <a href="https://www.learn-js.org/en/Callbacks" target="_blank">https://www.learn-js.org/en/Callbacks</a></li>
<li>Using setTimeout, change the background color of the page after 5 seconds
(5000 milliseconds).<ul>
<li>Bonus, have the color change <em>every</em> 5 seconds to something different
<img src="http://g.recordit.co/g2EqBccNzh.gif" alt=""></li>
</ul>
</li>
</ol>
<h2 id="map-function"><code>.map</code> function</h2>
<p>Using callbacks, you can easily apply a function to every element in an array
using the map function; The following snippet, will take an array, and return a
new array, where every element in the array is double.</p>
<p>Before:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> myArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// The starting array</span>
<span class="token keyword">var</span> newArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// The final array</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> myArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> doubleValue <span class="token operator">=</span> myArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Get the value and double it</span>
  newArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>doubleValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Add the new value, to the final array</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> myArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">double</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// Return double of x</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Applies the `double` function to every element in the array</span>
<span class="token keyword">var</span> newArray <span class="token operator">=</span> myArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>double<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="promises">Promises</h2>
<ul>
<li><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank">MDN docs</a></li>
<li><a href="https://www.promisejs.org/" target="_blank">promisejs.org</a></li>
<li><a href="https://developers.google.com/web/fundamentals/getting-started/primers/promises" target="_blank">Google Developer</a></li>
</ul>
<p>Promises are a new feature of JavaScript (Chrome only for now). They allow for
writing easier to understand code when dealing with asynchronous functions.
<img src="http://exploringjs.com/es6/images/promises----promise_states_simple.jpg" alt=""> The
API is very simple, when you have a promise, you can attach either a <code>then</code>
callback or a <code>catch</code> callback. If the promise is successful, the the function
in the <code>then</code> callback is called. If it fails, then the <code>catch</code> callback is
called.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> myPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// Do some work in this function</span>

  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// If the function was successful</span>
  <span class="token comment" spellcheck="true">//reject(50) // If the function failed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;success: &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myPromise<span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fail:&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="fetch">Fetch</h2>
<ul>
<li><a href="https://developer.mozilla.org/en/docs/Web/API/Fetch_API" target="_blank">MDN fetch API</a></li>
<li><a href="https://davidwalsh.name/fetch" target="_blank">David Walsh blog</a></li>
</ul>
<p><code>fetch</code> is a nicer (more modern) way of creating HTTP requests. It makes heavy
use of Promises.</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Chaining for more &quot;advanced&quot; handling</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.mocky.io/v2/584c3d2d1200001b1e372b01&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returning another Promise</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Do something with the json object</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Prints &apos;Hello world!&apos;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Exercise: Rewrite your homework from last week, using <code>fetch</code> and <code>Promises</code></p>
<h1 id="ajax">AJAX</h1>
<h3 id="whats-a-server">What&apos;s a server?</h3>
<p>A device or program that <strong>provides functionality to other programs or
devices</strong>. There are database servers, mail servers, game servers, etc.</p>
<p>They can take the form of industrial server farms that provide a service to
millions of users (used by Facebook, Google, etc.), to personal servers for
storing your files.</p>
<p>The server communicates with <strong>clients</strong>. Clients can be a web browser, a Slack
app, your phone, etc.</p>
<p>Client&#x2013;server systems use the <strong>request&#x2013;response model</strong>: a client sends a
request to the server, which performs some action and sends a response back to
the client, typically with a result or acknowledgement.</p>
<blockquote>
<p>An example: We can use the Slack app (the client) to put our messages or
pictures on Slack. The content is stored on the Slack servers and other
clients can then also access the pictures.</p>
</blockquote>
<h3 id="http-requests">HTTP requests</h3>
<p>A server stores the data, and the client (other programs or computers) requests
data or sends some of its own. But how do they talk to each other?</p>
<p><strong>For the client and the server to communicate they need an established language
(a protocol)</strong>. Which is what HTTP (Hypertext Transfer Protocol) is for. It
defines the methods you can use to communicate with a server and indicate your
desired actions on the resources of the server.</p>
<p>There are two main types of requests: GET and POST.</p>
<blockquote>
<p>With a <strong>GET request</strong> you can ask for specified resource (e.g. show me that
Slack photo).</p>
<p>With a <strong>POST request</strong> you can send content to the server to be appended to
the web resource (e.g. post a photo on Slack).</p>
</blockquote>
<p>HTTP is the language of the internet. In our case we&apos;re using Javascript, but
you can send HTTP requests with other laguages as well.</p>
<h3 id="ajax--asynchronous-javascript-and-xml">AJAX (= Asynchronous JavaScript And XML)</h3>
<p>AJAX is a set of useful methods for implementing client-server communication.</p>
<p><img src="https://www.w3schools.com/xml/ajax.gif" alt="AJAX Diagram" title="AJAX Diagram"></p>
<p>AJAX just uses a combination of:</p>
<blockquote>
<ul>
<li>A browser built-in XMLHttpRequest object (to request data from a web server)</li>
<li>JavaScript and HTML DOM (to display or use the data)</li>
</ul>
</blockquote>
<p><strong>Ajax works behind the scenes, helping the webpage communicate with the server
(with GET and POST requests).</strong></p>
<blockquote>
<p>client ----------GET request----------&gt; server returns data to client</p>
<p>client ----------POST request (with content)---------&gt;server updates data with
content</p>
</blockquote>
<p>The server holds the data, but it only sends it to the webpage when there&apos;s a
request. The request can be sent after the page has loaded, for example when a
user clicks a button.</p>
<h3 id="why-ajax">Why Ajax?</h3>
<p>There are other ways you can write HTTP requests, such as using Web sockets.
What&apos;s great about AJAX is that it makes it look like magic! The server and the
client communicate effortlessly:</p>
<blockquote>
<p>Update a web page without reloading the page Request data from a server -
after the page has loaded Receive data from a server - after the page has
loaded Send data to a server - in the background</p>
</blockquote>
<h3 id="ajax-example">AJAX Example</h3>
<p>The instant update: we can write code that makes the web page instantly update
its contents (without reloading the page).</p>
<p>Let&apos;s try sending some data from Rares&#x2019; phone to the server and see whether it
will update the webpage.</p>
<blockquote>
<p><a href="http://zero-point.github.io/" target="_blank">http://zero-point.github.io/</a></p>
</blockquote>
<h3 id="lets-code">Let&apos;s Code!</h3>
<p>How does the code work? Let&apos;s break it down into parts and see what each does.</p>
<h4 id="post-code">POST Code</h4>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//creating a request object</span>

request<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// check if a response was sent back</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// check if request was successful</span>
      textBox<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> request<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      textBox<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>
        <span class="token string">&quot;An error occurred during your request: &quot;</span> <span class="token operator">+</span>
        request<span class="token punctuation">.</span>status <span class="token operator">+</span>
        <span class="token string">&quot; &quot;</span> <span class="token operator">+</span>
        request<span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://ajax-cyf.eu-west-1.elasticbeanstalk.com/chatroom/?id=cyf&quot;</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//server location</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token string">&quot;Here is some content&quot;</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// content we want to send</span>
request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// adding them to the request</span>

request<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//header info</span>
request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// sending the request</span>
</code></pre>
<h4 id="get-code">GET Code</h4>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//creating a request object</span>

request<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// check if a response was sent back</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// check if request was successful</span>
      textBox<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> request<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      textBox<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>
        <span class="token string">&quot;An error occurred during your request: &quot;</span> <span class="token operator">+</span>
        request<span class="token punctuation">.</span>status <span class="token operator">+</span>
        <span class="token string">&quot; &quot;</span> <span class="token operator">+</span>
        request<span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://ajax-cyf.eu-west-1.elasticbeanstalk.com/chatroom/?id=cyf&quot;</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//server location</span>
request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// adding it to the request</span>

request<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//header info</span>
request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// sending the request</span>
</code></pre>
<h3 id="ajax-exercise">AJAX Exercise</h3>
<p>Everyone should organise in pairs, one person writing code to <strong>send data
(POST)</strong> and one to <strong>receive it (GET)</strong>. Once you&#x2019;ve finished your code,
combine it and put it into a html page. Now, try sending each other messages
this way.</p>
<p>Don&#x2019;t forget to use a <strong>unique id</strong> at the end of the url (not &apos;cyf&apos;) and let
your partner know what it is!</p>
<h2 id="resources">Resources</h2>
<ol>
<li>AJAX - <a href="https://developer.mozilla.org/en-US/docs/AJAX/Getting_Started" target="_blank">https://developer.mozilla.org/en-US/docs/AJAX/Getting_Started</a></li>
</ol>
<h1 id="homework">Homework</h1>
<ul>
<li>Finish this tutorial from BBC - <a href="http://www.bbc.co.uk/education/topics/z7tp34j" target="_blank">http://www.bbc.co.uk/education/topics/z7tp34j</a></li>
<li>Finish this CodeAcademy course on OOP in JavaScript -
<a href="https://www.codecademy.com/courses/javascript-beginner-en-vj8Tr/0/1" target="_blank">https://www.codecademy.com/courses/javascript-beginner-en-vj8Tr/0/1</a></li>
<li>Read Chapter 4 - Functions from the book: JavaScript: The Good Parts</li>
<li>Read Chapter 5 of Code Complete 2 (Design In Construction)</li>
<li>Read Chapter 7 (High Quality Routines)</li>
<li>[Optional] Read this chapter of Eloquent JavaScript -
<a href="http://eloquentjavascript.net/1st_edition/chapter8.html" target="_blank">http://eloquentjavascript.net/1st_edition/chapter8.html</a> (up to the exercises).
Try all the examples on Codepen.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../week-08/lesson.html" class="navigation navigation-prev " aria-label="Previous page: Week 8 - DOM, Events">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../js-core-3/" class="navigation navigation-next " aria-label="Next page: JavaScript III">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Week 9 - AJAX, Async, Promises","level":"1.6.3","depth":2,"next":{"title":"JavaScript III","level":"1.7","depth":1,"path":"js-core-3/index.md","ref":"js-core-3/index.md","articles":[{"title":"Week 10 - Good Code, TDD","level":"1.7.1","depth":2,"path":"js-core-3/week-10/lesson.md","ref":"js-core-3/week-10/lesson.md","articles":[]},{"title":"Week 11 - More TDD, ES6","level":"1.7.2","depth":2,"path":"js-core-3/week-11/lesson.md","ref":"js-core-3/week-11/lesson.md","articles":[]},{"title":"Week 12 - Exam maybe","level":"1.7.3","depth":2,"path":"js-core-3/week-12/lesson.md","ref":"js-core-3/week-12/lesson.md","articles":[]}]},"previous":{"title":"Week 8 - DOM, Events","level":"1.6.2","depth":2,"path":"js-core-2/week-08/lesson.md","ref":"js-core-2/week-08/lesson.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["prism","-highlight"],"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"js-core-2/week-09/lesson.md","mtime":"2017-12-01T20:10:06.204Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-12-01T20:11:28.264Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

