
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Week 2 - More MongoDB Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../week-3/lesson.html" />
    
    
    <link rel="prev" href="../week-1/lesson.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Course</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Before you start
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../others/lesson0.html">
            
                <a href="../../others/lesson0.html">
            
                    
                    Week 0 - Introduction and basic setup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../html-css/">
            
                <a href="../../html-css/">
            
                    
                    HTML/CSS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../html-css/week-1/lesson.html">
            
                <a href="../../html-css/week-1/lesson.html">
            
                    
                    Week 1 - Semantic HTML and CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../html-css/week-2/lesson.html">
            
                <a href="../../html-css/week-2/lesson.html">
            
                    
                    Week 2 - Responsive Web and layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../html-css/week-3/lesson.html">
            
                <a href="../../html-css/week-3/lesson.html">
            
                    
                    Week 3 - Design frameworks, Naming patterns and Forms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../js-core-1/">
            
                <a href="../../js-core-1/">
            
                    
                    JavaScript I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../js-core-1/week-1/lesson.html">
            
                <a href="../../js-core-1/week-1/lesson.html">
            
                    
                    Week 1 - Hello JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../js-core-1/week-2/lesson.html">
            
                <a href="../../js-core-1/week-2/lesson.html">
            
                    
                    Week 2 - Conditionals and Arrays
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../js-core-1/week-3/lesson.html">
            
                <a href="../../js-core-1/week-3/lesson.html">
            
                    
                    Week 3 - More Arrays
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../js-core-2/">
            
                <a href="../../js-core-2/">
            
                    
                    JavaScript II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../js-core-2/week-1/lesson.html">
            
                <a href="../../js-core-2/week-1/lesson.html">
            
                    
                    Week 1 - Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../js-core-2/week-2/lesson.html">
            
                <a href="../../js-core-2/week-2/lesson.html">
            
                    
                    Week 2 - JS in the Browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../js-core-2/week-3/lesson.html">
            
                <a href="../../js-core-2/week-3/lesson.html">
            
                    
                    Week 3 - Asynchronous and The Web
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../js-core-3/">
            
                <a href="../../js-core-3/">
            
                    
                    JavaScript III
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../js-core-3/week-1/lesson.html">
            
                <a href="../../js-core-3/week-1/lesson.html">
            
                    
                    Week 1 - Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../js-core-3/week-2/lesson.html">
            
                <a href="../../js-core-3/week-2/lesson.html">
            
                    
                    Week 2 - APIs and Fetch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../js-core-3/week-3/lesson.html">
            
                <a href="../../js-core-3/week-3/lesson.html">
            
                    
                    Week 3 - Scope and ES6
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../react/">
            
                <a href="../../react/">
            
                    
                    React
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../react/week-1/lesson.html">
            
                <a href="../../react/week-1/lesson.html">
            
                    
                    Week 1 - React 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../react/week-2/lesson.html">
            
                <a href="../../react/week-2/lesson.html">
            
                    
                    Week 2 - Reacting to Changes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../react/week-3/lesson.html">
            
                <a href="../../react/week-3/lesson.html">
            
                    
                    Week 3 - Fetching Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../react/week-4/lesson.html">
            
                <a href="../../react/week-4/lesson.html">
            
                    
                    Routing (optional)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../react/classes-optional/lesson.html">
            
                <a href="../../react/classes-optional/lesson.html">
            
                    
                    Class components (optional)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../node/">
            
                <a href="../../node/">
            
                    
                    Node
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../node/week-1/lesson.html">
            
                <a href="../../node/week-1/lesson.html">
            
                    
                    Week 1 - Node and Express 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../node/week-2/lesson.html">
            
                <a href="../../node/week-2/lesson.html">
            
                    
                    Week 2 - Middleware, Templating and APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../node/week-3/lesson.html">
            
                <a href="../../node/week-3/lesson.html">
            
                    
                    Week 3 - Advanced Node
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../db/">
            
                <a href="../../db/">
            
                    
                    SQL Databases
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../db/week-1/lesson.html">
            
                <a href="../../db/week-1/lesson.html">
            
                    
                    Week 1 - Introduction to SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../../db/week-2/lesson.html">
            
                <a href="../../db/week-2/lesson.html">
            
                    
                    Week 2 - More SQL and integration with NodeJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../../db/week-3/lesson.html">
            
                <a href="../../db/week-3/lesson.html">
            
                    
                    Week 3 - More integration with NodeJS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../">
            
                <a href="../">
            
                    
                    MongoDB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../week-1/lesson.html">
            
                <a href="../week-1/lesson.html">
            
                    
                    Week 1 - Introduction to MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.2" data-path="lesson.html">
            
                <a href="lesson.html">
            
                    
                    Week 2 - More MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../week-3/lesson.html">
            
                <a href="../week-3/lesson.html">
            
                    
                    Week 3 - Advanced MongoDB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../finalproject/intro.html">
            
                <a href="../../finalproject/intro.html">
            
                    
                    Final Project
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../../finalproject/intro.html">
            
                <a href="../../finalproject/intro.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../../finalproject/roles.html">
            
                <a href="../../finalproject/roles.html">
            
                    
                    Roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../../finalproject/firstweek.html">
            
                <a href="../../finalproject/firstweek.html">
            
                    
                    First Week
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../../finalproject/finalweek.html">
            
                <a href="../../finalproject/finalweek.html">
            
                    
                    Final Week
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Workshops</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../others/deployment/1-for-html-module/workshop-1-basic-automatic-deployment-with-netlify-mentor-notes.html">
            
                <a href="../../others/deployment/1-for-html-module/workshop-1-basic-automatic-deployment-with-netlify-mentor-notes.html">
            
                    
                    Deploying Code Workshop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../node/week-1/workshop.html">
            
                <a href="../../node/week-1/workshop.html">
            
                    
                    Express Workshop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../node/week-3/workshop.html">
            
                <a href="../../node/week-3/workshop.html">
            
                    
                    Hotel Workshop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../others/aws-workshop-2.html">
            
                <a href="../../others/aws-workshop-2.html">
            
                    
                    AWS & DynamoDB Workshop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../others/git-desktop-workshop.html">
            
                <a href="../../others/git-desktop-workshop.html">
            
                    
                    Github Desktop Workshop
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Guides</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../html-css/compile-scss-instructions.html">
            
                <a href="../../html-css/compile-scss-instructions.html">
            
                    
                    Compiling SCSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../others/coding-101.html">
            
                <a href="../../others/coding-101.html">
            
                    
                    Coding 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../others/react-cheatsheet.html">
            
                <a href="../../others/react-cheatsheet.html">
            
                    
                    React Cheatsheet
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Modules</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../others/java.html">
            
                <a href="../../others/java.html">
            
                    
                    Java Module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../others/mongodb-101.html">
            
                <a href="../../others/mongodb-101.html">
            
                    
                    MongoDB Module
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">For Students</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../others/coding-standards.html">
            
                <a href="../../others/coding-standards.html">
            
                    
                    Coding Standards and Best Practices
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">For Teachers</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <span>
            
                    
                    Teaching Notes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../../html-css/week-1/mentors.html">
            
                <a href="../../html-css/week-1/mentors.html">
            
                    
                    HTML/CSS - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../../html-css/week-2/mentors.html">
            
                <a href="../../html-css/week-2/mentors.html">
            
                    
                    HTML/CSS - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../../html-css/week-3/mentors.html">
            
                <a href="../../html-css/week-3/mentors.html">
            
                    
                    HTML/CSS - Week 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../../js-core-1/week-1/mentors.html">
            
                <a href="../../js-core-1/week-1/mentors.html">
            
                    
                    JavaScript I - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../../js-core-1/week-2/mentors.html">
            
                <a href="../../js-core-1/week-2/mentors.html">
            
                    
                    JavaScript I - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6" data-path="../../js-core-1/week-3/mentors.html">
            
                <a href="../../js-core-1/week-3/mentors.html">
            
                    
                    JavaScript I - Week 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7" data-path="../../js-core-2/week-1/mentors.html">
            
                <a href="../../js-core-2/week-1/mentors.html">
            
                    
                    JavaScript II - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.8" data-path="../../js-core-2/week-2/mentors.html">
            
                <a href="../../js-core-2/week-2/mentors.html">
            
                    
                    JavaScript II - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.9" data-path="../../js-core-2/week-3/mentors.html">
            
                <a href="../../js-core-2/week-3/mentors.html">
            
                    
                    JavaScript II - Week 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.10" data-path="../../js-core-3/week-1/mentors.html">
            
                <a href="../../js-core-3/week-1/mentors.html">
            
                    
                    JavaScript III - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11" data-path="../../js-core-3/week-2/mentors.html">
            
                <a href="../../js-core-3/week-2/mentors.html">
            
                    
                    JavaScript III - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.12" data-path="../../js-core-3/week-3/mentors.html">
            
                <a href="../../js-core-3/week-3/mentors.html">
            
                    
                    JavaScript III - Week 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.13" data-path="../../react/week-1/mentors.html">
            
                <a href="../../react/week-1/mentors.html">
            
                    
                    React - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.14" data-path="../../react/week-2/mentors.html">
            
                <a href="../../react/week-2/mentors.html">
            
                    
                    React - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.15" data-path="../../react/week-3/mentors.html">
            
                <a href="../../react/week-3/mentors.html">
            
                    
                    React - Week 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.16" data-path="../../node/week-1/mentors.html">
            
                <a href="../../node/week-1/mentors.html">
            
                    
                    Node - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.17" data-path="../../node/week-2/mentors.html">
            
                <a href="../../node/week-2/mentors.html">
            
                    
                    Node - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.18" data-path="../../node/week-3/mentors.html">
            
                <a href="../../node/week-3/mentors.html">
            
                    
                    Node - Week 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.19" data-path="../../db/week-1/mentors.html">
            
                <a href="../../db/week-1/mentors.html">
            
                    
                    Databases - Week 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.20" data-path="../../db/week-2/mentors.html">
            
                <a href="../../db/week-2/mentors.html">
            
                    
                    Databases - Week 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.21" data-path="../../db/week-3/mentors.html">
            
                <a href="../../db/week-3/mentors.html">
            
                    
                    Databases - Week 3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Week 2 - More MongoDB</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><img src="https://img.shields.io/badge/status-review-orange.svg" alt="Lesson in review"></p>
<h1 id="mongodb---2">MongoDB - 2</h1>
<hr>
<p><strong>Teaching this lesson?</strong></p>
<p>Read the Mentors Notes <a href="mentors.md">here</a></p>
<hr>
<h2 id="outline">Outline:</h2>
<ul>
<li>Review</li>
<li>Signing up for MongoDB Atlas</li>
<li>Making a local Express server</li>
<li>Connecting to a MongoDB server from a local Node server</li>
<li>Creating and dropping databases and collections in Atlas</li>
<li>Reading documentation</li>
<li>BSON types</li>
<li>Creating documents</li>
<li>Creating a document in Atlas</li>
<li>Creating a document with the MongoDB Node Driver</li>
<li>Updating a document</li>
<li>Deleting a document</li>
</ul>
<h2 id="review">Review</h2>
<p>In the last lesson, we learned</p>
<ul>
<li>what a database is,</li>
<li>what a DBMS is,</li>
<li>what MongoDB is,</li>
<li>what a callback function is,</li>
<li>how to connect to a MongoDB server from a Node server,</li>
<li>how to get all documents in a collection,</li>
<li>how to search for documents in a collection, and</li>
<li>how to get a single document in a collection using its ID.</li>
</ul>
<p>Now that we know how to read databases, collections, and documents, let&apos;s learn how to create, update, and delete them.</p>
<h2 id="signing-up-for-mongodb-atlas">Signing up for MongoDB Atlas</h2>
<p>MongoDB Atlas is an online service for hosting a MongoDB database server. Luckily, there is a free version for simple projects like ours. Let&apos;s sign up for an account so we can create our own database.</p>
<ol>
<li>Go to the <a href="https://www.mongodb.com/cloud/atlas" target="_blank">MongoDB Atlas website</a>.</li>
<li>Click the &quot;Try Free&quot; button at the top of the page.</li>
<li>Enter your email address, your name, and a new password, then agree to the terms and click &quot;Get started free&quot;.</li>
<li>When you see a popup, click the &quot;Build my first cluster&quot; button. It might ask you some questions and give you some tips, but you can skip those.</li>
<li>Click the &quot;Create Cluster&quot; button at the bottom of the page.</li>
</ol>
<p>This actually creates a group of servers called a &quot;cluster&quot;. However, it might take a few minutes for the cluster to be ready. While it is being prepared, let&apos;s make an Express server to connect to one of the servers in the cluster.</p>
<h2 id="making-a-local-express-server">Making a local Express server</h2>
<p>In the last lesson, we made an Express server on Glitch. In this lesson, however, we will make one on our own computer -- in other words, we will make a &quot;local&quot; server.</p>
<p>Running a local server is the way most professional developers work, so it is important for you to learn.</p>
<p>Here, we will start by opening a terminal shell:</p>
<ul>
<li>On Mac, open the Terminal app in the <code>Applications/Utilities</code> directory.</li>
<li>On Ubuntu, press <code>ctrl+alt+t</code>.</li>
<li>On Windows, you can try the <a href="https://devblogs.microsoft.com/commandline/bash-on-ubuntu-on-windows-download-now-3/" target="_blank">Windows Subsystem for Linux</a>. If this does not work, you can try Git BASH, which you can get by downloading <a href="https://gitforwindows.org/" target="_blank">Git for Windows</a>.</li>
</ul>
<p>In the shell, let&apos;s make a new directory for our Express server project. You can</p>
<ul>
<li>list directories by entering <code>ls</code> in the shell,</li>
<li>change directories with <code>cd</code> (for example, <code>cd Desktop</code> to go to a <code>Desktop</code> directory), and</li>
<li>make a new directory with <code>mkdir</code> (for example, <code>mkdir cyf-db-lesson-2</code> to make an <code>cyf-db-lesson-2</code> directory).</li>
</ul>
<p>Now, let&apos;s check if you already have Node and Node Pacakage Manager (NPM) installed. These will let you run a JavaScript server and add packages like Express to your project. To check for Node and NPM, run this in the terminal shell:</p>
<pre class="language-"><code class="lang-js">npm <span class="token operator">--</span>version
</code></pre>
<p>If you see a version number (for example, <code>6.9.0</code>), you should be ready. Otherwise, try downloading Node from <a href="https://nodejs.org/en/" target="_blank">here</a> and installing it. It should also install NPM automatically.</p>
<p>Once <code>npm --version</code> works, you can add Express. Inside of your new project directory, run this in the shell:</p>
<pre class="language-"><code class="lang-js">npm install express
</code></pre>
<p>If it works, you should see a bunch of technical stuff appear on the screen. You can ignore most of it for now. However, at the bottom, you should see something like this:</p>
<pre class="language-"><code class="lang-js"><span class="token operator">+</span> express@<span class="token number">4.17</span><span class="token number">.1</span>
added <span class="token number">50</span> packages <span class="token keyword">from</span> <span class="token number">37</span> contributors and audited <span class="token number">126</span> packages <span class="token keyword">in</span> <span class="token number">2.263</span>s
found <span class="token number">0</span> vulnerabilities
</code></pre>
<p>This basically means that NPM successfully added Express to your project directory.</p>
<p>Doing this also added two things to our directory: <code>node_modules</code> and <code>package-lock.json</code>. <code>node_modules</code> is a directory that has (1) the Express package and (2) any other NPM packages that it needs. <code>package-lock.json</code> is a file that has the versions of these NPM packages. You can usually just ignore <code>node_modules</code> and <code>package-lock.json</code>.</p>
<p>Now that we have Express ready, let&apos;s start writing our JavaScript. Open your favourite code editor (for example, Visual Studio Code) and create a new file with this:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Save this as <code>server.js</code> in your project directory.</p>
<p>The code should look a bit familiar from previous lessons. It imports Express, creates a new Express app, tells Express to return &quot;Hello, world!&quot; when you go to the <code>/</code> endpoint, and starts listening for requests on port 3000.</p>
<p>Let&apos;s run it. Back in your shell, enter this:</p>
<pre class="language-"><code class="lang-js">node server<span class="token punctuation">.</span>js
</code></pre>
<p>This starts the Node server that we wrote in <code>server.js</code>. When you run a server on your computer, you can usually get to it by going to <code>localhost</code> in your browser. However, because we told it to listen to port 3000, we need to go to <a href="http://localhost:3000/" target="_blank"><code>localhost:3000</code></a>. When you go here in your browser, you should see &quot;Hello, world!&quot;</p>
<h2 id="connecting-to-a-mongodb-server-from-a-local-node-server">Connecting to a MongoDB server from a local Node server</h2>
<p>We now have a working Node server that uses the Express package. Let&apos;s connect it to a server in our new MongoDB cluster.</p>
<p>Add the MongoDB Node Driver package to your project. To do this, stop your server by pressing <code>ctrl+c</code>, and run this in the terminal:</p>
<pre class="language-"><code class="lang-js">npm install mongodb
</code></pre>
<p>To use the driver to connect to our MongoDB server, we need to finish some more tasks on Atlas. Go back to the Atlas website in your browser, and you should see a &quot;CONNECT&quot; button. Click that, and you should see a new window with two steps: (1) whitelisting IP addresses and (2) creating a MongoDB user.</p>
<p>In step 1, click a button to add a new IP address. A form should appear. Use the IP address <code>0.0.0.0</code>, which lets you use the database anywhere, and click the button to add it.</p>
<p>In step 2, enter a new username (for example, <code>cyf</code>) and new password that you will not forget (for example, <code>LetsLearnMongoDB2019</code>). You will put these in your code, so if you want people to look at your code, do not use a password you use somewhere else! Click the button to create the user, and then click the &quot;Choose a connection method&quot; button.</p>
<p>You should now see three options. Click the second option: &quot;Connect Your Application&quot;. This should show you a database URI that you can use to connect to a server in your MongoDB cluster.</p>
<p>Note: you only need to use the part of the URI up to <code>mongodb.net</code> (not the <code>/test?...</code> part).</p>
<p>Now, let&apos;s write some code. Open your <code>server.js</code> file again, and add a new line at the top to import the MongoDB driver:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> mongodb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Also add a line before your endpoints to define the database URI from Atlas, without the <code>/test?...</code> part:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> uri <span class="token operator">=</span> <span class="token string">&quot;mongodb+srv://xxxx:xxxx@cluster0-xxxx.mongodb.net&quot;</span><span class="token punctuation">;</span>
</code></pre>
<p>Make sure that you use the real username, password, and address in this string. In the previous lesson, we were using public code on Glitch, so we put this in an environment variable. However, because this is local code and not public, we can put the password in the code for now.</p>
<p>Warning: do not put this code on Glitch or in a Git repository! If you do that, your password will become public, and then anyone can edit your database! (If you really want to make the code public, look into using environment variables.)</p>
<p>With the URI, we can now connect to a database. Let&apos;s do that in the endpoint callback function:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongodb<span class="token punctuation">.</span>MongoClient</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

  client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;It worked!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Let&apos;s try to run this. Back in the shell, if you are still running your Node server, stop it by pressing <code>ctrl+c</code>. You need to run it again to run your new code:</p>
<pre class="language-"><code class="lang-js">node server<span class="token punctuation">.</span>js
</code></pre>
<p>Once you run this, try reloading <code>localhost:3000</code> in your browser, and you should see &quot;It worked!&quot;</p>
<h2 id="creating-and-dropping-databases-and-collections-in-atlas">Creating and dropping databases and collections in Atlas</h2>
<p>To make our Express server useful, we need some data in our database. Let&apos;s learn how to add a database and a collection.</p>
<p>To add a database, click the &quot;COLLECTIONS&quot; button on Atlas. Let&apos;s add our own data, so click the &quot;Add my own data&quot; button.</p>
<p>Now, you can enter the names of your first database and collection. Enter whatever you want, but you cannot use spaces or some special characters. Then click the Create button.</p>
<p>After that, you should see your collection (but it does not have any documents yet).</p>
<p>If you ever want to delete a collection, hover over the the name of the collection in the database list, and click the rubbish bin icon to the right. A modal appears, and you just need to type in the name of the collection and click the Drop button to confirm.</p>
<p>When you drop a collection, if your database has nothing in it, the database will just disappear.</p>
<p>If you want to drop a whole database and all its collections and documents at the same time, just follow the same steps for the database: click the rubbish bin next to it, enter the name, and click the Drop button.</p>
<p>Now that we can create collections, we can create some documents. However, before we do that, let&apos;s look at a great way to help us understand the details.</p>
<h2 id="reading-documentation">Reading documentation</h2>
<p>When you use tech like Node, Express, or MongoDB, you can usually find official notes online that tell you details about how to use it. These are called the &quot;<strong>documentation</strong>&quot; or &quot;docs&quot;. Usually, you can find them on the official website.</p>
<p>For MongoDB, you can find the documentation at <a href="https://docs.mongodb.com/" target="_blank"><code>docs.mongodb.com</code></a>. Let&apos;s see what it has.</p>
<p>If you go to the MongoDB docs, you can find basic introductions like Getting Started and deeper explanations like the MongoDB Manual. If you want to search for something specific, you can use the search field at the top of the page.</p>
<p>Warning: be careful when reading code in the MongoDB docs, because it is usually not for the MongoDB Node Driver! Typically, when you see code, it will be for what is called the &quot;Mongo Shell&quot;, which is another way to access a database. It looks similar to the kind of code we have been writing, but if you use it on a Node server, you might get confusing errors.</p>
<p>Let&apos;s find the docs just for the MongoDB Node Driver. On the left side bar, click &quot;MongoDB Drivers&quot;. This takes you to a page with drivers for different coding languages. Click &quot;Node.js&quot;, which will take you to the MongoDB Node Driver page. A very helpful link here is &quot;Usage Guide&quot;.</p>
<p>Another very helpful link is &quot;API Reference&quot;. Open this in a new tab. We will come back to it later.</p>
<p>In the next section, we will learn about <strong>BSON</strong>, the JSON-like format used for MongoDB documents. Before we start, click the &quot;Server&quot; tab at the top of the page, try searching for &quot;BSON&quot; in the docs, and then open the BSON Types page.</p>
<h2 id="bson-types">BSON Types</h2>
<p>Many coding languages have a list of data types. For example, in JavaScript, there is</p>
<ul>
<li>Number,</li>
<li>String,</li>
<li>Boolean (<code>true</code> or <code>false</code>),</li>
<li><code>null</code>,</li>
<li><code>undefined</code>, and</li>
<li>Object.</li>
</ul>
<p>In BSON (which stands for &quot;Binary JSON&quot;), the data types are different and a bit more complicated. Here are some of them:</p>
<ul>
<li>32-bit integer -- for whole numbers with no decimal points (examples: <code>0</code>, <code>1</code>, <code>183941</code>, <code>-42</code>)</li>
<li>Double -- for number with decimal points (examples: <code>0.1</code>, <code>1.0</code>, <code>-31.39585</code>)</li>
<li>String</li>
<li>Boolean</li>
<li>Null</li>
<li>Object</li>
<li>Array</li>
<li>ObjectId -- the <code>ObjectId</code>s you learned about in the last lesson</li>
<li>Date -- like JavaScript <code>Date</code>s</li>
</ul>
<p>You can find all of them and more information about them on that MongoDB docs page.</p>
<p>We will use some of these BSON types when we create our first documents.</p>
<h2 id="creating-documents">Creating documents</h2>
<p>Let&apos;s learn a couple of ways to create MongoDB documents.</p>
<h3 id="creating-a-document-in-atlas">Creating a document in Atlas</h3>
<p>Now, we are finally ready to make our first database documents! Let&apos;s open Atlas again and create a new database: <code>cinema</code>. Let&apos;s also create a new collection called <code>films</code>.</p>
<p>To create a document in Atlas, click the &quot;INSERT DOCUMENT&quot; button on the right side of the page. A popup will appear with an <code>ObjectId</code> already made for us. Now, we can add the rest of the fields.</p>
<p>To start, let&apos;s add a field called <code>title</code> for our film names. To the right of the field, you can see that there is already a data type selected: String. This is perfect for a title, so let&apos;s just type the name of a film as the field value. Use one of your favourite films! Then, press Enter.</p>
<p>Let&apos;s try another field with another data type. Add a field named <code>year</code>, and select the type &quot;Int32&quot; (for 32-bit integer) so we can add numbers without decimal points. As the value, put the year the film was released. (Don&apos;t know the year? Use <a href="https://imdb.com/" target="_blank">IMDb</a> to find out.)</p>
<p>Now, let&apos;s try adding a new data type: Array. Select Array from the drop-down list, and give it the name <code>actors</code>. You should see the index <code>0</code> appear below it. Here, you can enter the name of an actor in the film. When you press Enter, you can add even more.</p>
<p>When you have entered a few actors, click the Insert button to add the document. Now, you can see it inside of your collection.</p>
<p>That is how you can add a document easily with MongoDB Atlas.</p>
<h4 id="excercise">Excercise</h4>
<p>Try adding two new films to your database. Give each of them a title, year, and a few actors.</p>
<h3 id="creating-a-document-with-the-mongodb-node-driver">Creating a document with the MongoDB Node Driver</h3>
<p>When you build an app, you might also want to add documents from your server. This is how you can add a single document:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

collection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Here, you can just make a normal object that will convert to JSON, and MongoDB will automatically convert the data types to BSON. Also, if you do not include the <code>_id</code> field, MongoDB will automatically add one for you.</p>
<p>Notice that the callback function for <code>insertOne</code> has a <code>result</code> argument. This is an object that has some useful information about what you inserted into the collection. One useful property is <code>result.ops</code>, which is an array with all the documents you just created, including the automatic <code>_id</code>.</p>
<p>Let&apos;s try adding an endpoint for creating a film to our code. Open up your code editor again, and add this new endpoint:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/films&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongodb<span class="token punctuation">.</span>MongoClient</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

  client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">&quot;cinema&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;films&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> film <span class="token operator">=</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Princess Mononoke&quot;</span><span class="token punctuation">,</span>
      year<span class="token operator">:</span> <span class="token number">1997</span><span class="token punctuation">,</span>
      actors<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Billy Crudup&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Billy Bob Thorton&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Claire Danes&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    collection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>film<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error <span class="token operator">||</span> result<span class="token punctuation">.</span>ops<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Here, when the user sends a <code>POST</code> request to <code>/films</code>, the server creates a new film document with the title &quot;Princess Mononoke&quot; and responds with the inserted document, including the new <code>_id</code> field.</p>
<p>To try it, restart your server first: go to your terminal shell, press <code>ctrl+c</code> to stop the server, press the <code>up</code> key to go to your previous command, and then press <code>enter</code>. Now, try sending a <code>POST</code> request to <code>localhost:3000/films</code> with Postman, and then check your collection on Atlas.</p>
<h4 id="exercise">Exercise</h4>
<p>Update the new endpoint to take query parameters <code>title</code>, <code>year</code>, and <code>actors</code> and create and return a new film with those fields and values. Make sure that only those fields are added. If a query parameter is missing, return a <code>400</code> error. Make sure that the year is a number in the database (not a string). Let the actors be separated by commas.</p>
<p>For example, sending a <code>POST</code> request to <code>/films?title=Ex Machina&amp;year=2014&amp;actors=Domhnall Gleeson,Oscar Isaac,Alicia Vikander</code> should create a new film document in the database like this:</p>
<pre class="language-"><code class="lang-js"><span class="token punctuation">{</span>
  <span class="token string">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5d057f95243295255b98b6a0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ex Machina&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">2014</span><span class="token punctuation">,</span>
  <span class="token string">&quot;actors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Domhnall Gleeson&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Oscar Isaac&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Alicia Vikander&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>(Hint: you can turn a string like <code>a,b,c</code> into an array like <code>[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;]</code> with <code>&apos;a,b,c&apos;.split(&apos;,&apos;)</code>.)</p>
<h2 id="updating-a-document">Updating a document</h2>
<p>To update a single document, you can use <code>findOneAndUpdate</code> with a <code>$set</code> operator like this:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> searchObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> updateObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

collection<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>searchObject<span class="token punctuation">,</span> updateObject<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter">error<span class="token punctuation">,</span>
  result</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This will update the first document that matches <code>searchObject</code> with the fields in <code>updateObject</code> using some <code>options</code>.</p>
<p>There are several options you can use. The one that we will use in this lesson is <code>returnOriginal</code>. If your options include <code>returnOriginal: false</code>, then you can get the updated document (not the original one) from <code>result</code>.</p>
<p>However, <code>result</code> here is different than the one for <code>insertOne</code>. To see what this is, let&apos;s go to the <a href="http://mongodb.github.io/node-mongodb-native/3.2/api/" target="_blank">API Reference</a> tab we opened earlier.</p>
<p>On this page, on the left side bar, we can see many objects we can use from the <code>mongodb</code> package. We want to find information about the <code>findOneAndUpdate</code> function, which is on a <code>Collection</code>, so let&apos;s click the &quot;Collection&quot; link. This opens many properties that a <code>Collection</code> has, including its methods (functions). Find and click the link for <code>findOneAndUpdate</code>.</p>
<p>Here, we can see description of the function and its arguments. For example, you can see a list of options we can use. We can also see a column with the arguments types. We want to see what we can do with the <code>result</code> argument of the callback function, so click the type for <code>callback</code>: &quot;<a href="http://mongodb.github.io/node-mongodb-native/3.2/api/Collection.html#~findAndModifyCallback" target="_blank">Collection~findAndModifyCallback</a>&quot;.</p>
<p>Now, we can see the description of what our callback function and its arguments should be. Click on the type of <code>result</code> so we can find out more about it: &quot;<a href="http://mongodb.github.io/node-mongodb-native/3.2/api/Collection.html#~findAndModifyWriteOpResult" target="_blank">Collection~findAndModifyWriteOpResult</a>&quot;.</p>
<p>Finally, we can see the properties of <code>result</code>. Notice the first property, <code>value</code>, which will be our updated document. We can use this to return the updated document to the user.</p>
<p>Note: at the time of writing this lesson, the docs have some problems. For example, the description of the <code>value</code> property says that it is from the <code>findAndModify</code> command, but it is really from the <code>findAndUpdateOne</code> command for us. Mistakes like these are not uncommon in documentation. (If you are stuck on something, and docs do not help, a good place to ask for help is <a href="https://stackoverflow.com/" target="_blank">Stack Overflow</a>.)</p>
<p>Now, we know how to use <code>result</code>. For example, we can do this:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> searchObject <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">&quot;Princess Mononoke&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> updateObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    year<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> returnOriginal<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

collection<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>searchObject<span class="token punctuation">,</span> updateObject<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter">error<span class="token punctuation">,</span>
  result</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error <span class="token operator">||</span> result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Here, we make a search object for a film whose title is &quot;Princess Mononoke&quot;. We also make an update object to set the film&apos;s year to 2000. We also set some options to include the updated film in <code>result</code> (not the original film, whose <code>year</code> was <code>1997</code>). We then pass these to <code>collection.findOneAndUpdate</code> with a callback function. After the Node Driver finds the first film with that matches the search object and updates it with the update object, it runs the callback function, which responds with the new film document (or an error) and closes the client.</p>
<p>Let&apos;s try it in our code. Add a new endpoint like this:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/films&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongodb<span class="token punctuation">.</span>MongoClient</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

  client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">&quot;cinema&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;films&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> searchObject <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">&quot;Princess Mononoke&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> updateObject <span class="token operator">=</span> <span class="token punctuation">{</span>
      $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        year<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> returnOriginal<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    collection<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>searchObject<span class="token punctuation">,</span> updateObject<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
      <span class="token parameter">error<span class="token punctuation">,</span>
      result</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error <span class="token operator">||</span> result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Now, when we make a <code>PUT</code> request to <code>/films</code>, the server changes the year of Princess Mononoke to 2000, and it returns the film.</p>
<p>To try it, restart your server again (in the terminal: <code>ctrl+c</code>, <code>up</code>, <code>enter</code>) and make a <code>PUT</code> request to <code>localhost:3000/films</code> in Postman.</p>
<h4 id="exercise">Exercise</h4>
<p>Change the new endpoint to <code>/films/:id</code>, and make it take a JSON object body and replace the document that has that <code>id</code>.</p>
<p>If the <code>id</code> is not a valid <code>ObjectId</code> string, return a <code>400</code> status code.</p>
<p>Allow only the properties <code>_id</code>, <code>title</code>, <code>year</code>, and <code>actors</code>. Do not allow objects with missing properties. Only allow the correct data type for each property. Do not allow the <code>_id</code> to be changed. If the JSON body is not allowed, return a <code>422</code> status code.</p>
<p>If no film has that <code>id</code>, return a <code>404</code> status code.</p>
<p>If the update is successful, return the updated document.</p>
<p>For example, if there is a film with <code>_id: ObjectId(&quot;5d057f95243295255b98b6a0&quot;)</code>, then sending a <code>PUT</code> request to <code>/films/5d057f95243295255b98b6a0</code> should update that film with the JSON body.</p>
<p>Hint: use this function to check if the request body is allowed.</p>
<pre class="language-"><code class="lang-js"><span class="token comment">/** Given `request.params` and `request.body`, check if the `PUT` request body is allowed. */</span>
<span class="token keyword">function</span> <span class="token function">getPutBodyIsAllowed</span><span class="token punctuation">(</span><span class="token parameter">requestParams<span class="token punctuation">,</span> requestBody</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fieldNames <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> allowedFieldNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;year&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;actors&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    fieldNames<span class="token punctuation">.</span>length <span class="token operator">===</span> allowedFieldNames<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
    fieldNames<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> allowedFieldNames<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    requestParams<span class="token punctuation">.</span>id <span class="token operator">===</span> requestBody<span class="token punctuation">.</span>_id <span class="token operator">&amp;&amp;</span>
    <span class="token keyword">typeof</span> requestBody<span class="token punctuation">.</span>title <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span>
    <span class="token keyword">typeof</span> requestBody<span class="token punctuation">.</span>year <span class="token operator">===</span> <span class="token string">&quot;number&quot;</span> <span class="token operator">&amp;&amp;</span>
    Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">.</span>actors<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    requestBody<span class="token punctuation">.</span>actors<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">actor</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> actor <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="deleting-a-document">Deleting a document</h2>
<p>To delete a single document, you can use <code>collection.deleteOne</code> like this:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> searchObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

collection<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>searchObject<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This will delete the first object that matches the fields in <code>searchObject</code>.</p>
<p>Here, <code>result</code> is also different than before. One property we will use is <code>result.deletedCount</code>, which should be <code>1</code> if a document was deleted.</p>
<p>Question: what status code should we give if we delete something successfully? When we call <code>response.send()</code>, the code will be <code>200</code> by default. However, <code>200</code> actually means that the response will should have some data. When we delete a film, though, we are removing the data for that film, so we do not need to return it. The status code for success but no data is <code>204</code>. (You can learn more about HTTP status codes <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank">here</a>.)</p>
<p>Let&apos;s see an example of <code>deleteOne</code> and a <code>204</code> response:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> searchObject <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">&quot;Princess Mononoke&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

collection<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>searchObject<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>deletedCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This tries to delete the first document with the title &quot;Princess Mononoke&quot;. If an error happens, it returns a <code>500</code> status code and the error in the response body. Otherwise, if something was deleted, it returns an empty <code>204</code> response. If something was <em>not</em> deleted, that means that MongoDB could not find any match, so it returns an empty <code>404</code> response.</p>
<p>Let&apos;s put this in a new endpoint of our code:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;/films/:title&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongodb<span class="token punctuation">.</span>MongoClient</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

  client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">&quot;cinema&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;films&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> searchObject <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">;</span>

    collection<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>searchObject<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>deletedCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>When a user sends a <code>DELETE</code> request to <code>/films/Princess Mononoke</code>, for example, it should either (1) delete the first film called &quot;Princess Mononoke&quot; if it exists and return <code>204</code> (2) just return <code>404</code> if it does not exist.</p>
<p>To try it, restart your server, find a film title in your database, and send a <code>DELETE</code> request to <code>/films/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>put</span> <span class="token attr-name">the</span> <span class="token attr-name">film</span> <span class="token attr-name">title</span> <span class="token attr-name">here</span><span class="token punctuation">&gt;</span></span></code> in Postman.</p>
<h4 id="exercise">Exercise</h4>
<p>Change the new endpoint to <code>/films/:id</code>. Make it delete only the object with the given <code>id</code>.</p>
<h1 id="homework">Homework</h1>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../week-1/lesson.html" class="navigation navigation-prev " aria-label="Previous page: Week 1 - Introduction to MongoDB">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../week-3/lesson.html" class="navigation navigation-next " aria-label="Next page: Week 3 - Advanced MongoDB">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Week 2 - More MongoDB","level":"1.10.2","depth":2,"next":{"title":"Week 3 - Advanced MongoDB","level":"1.10.3","depth":2,"path":"mongodb/week-3/lesson.md","ref":"mongodb/week-3/lesson.md","articles":[]},"previous":{"title":"Week 1 - Introduction to MongoDB","level":"1.10.1","depth":2,"path":"mongodb/week-1/lesson.md","ref":"mongodb/week-1/lesson.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["prism","-highlight"],"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"mongodb/week-2/lesson.md","mtime":"2020-06-25T22:40:39.353Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-06-25T22:41:23.995Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

