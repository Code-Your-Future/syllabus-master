
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Week 18 - Data Integrity & Analytics Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../react/" />
    
    
    <link rel="prev" href="../week-17/lesson.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Course</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Before you start
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../others/lesson0.html">
            
                <a href="../../others/lesson0.html">
            
                    
                    Week 0 - Introduction and basic setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../house-rules.html">
            
                <a href="../../house-rules.html">
            
                    
                    House Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../html-css/">
            
                <a href="../../html-css/">
            
                    
                    HTML/CSS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../html-css/week-01/lesson.html">
            
                <a href="../../html-css/week-01/lesson.html">
            
                    
                    Week 1 - Semantic HTML and CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../html-css/week-02/lesson.html">
            
                <a href="../../html-css/week-02/lesson.html">
            
                    
                    Week 2 - Responsive Web and layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../html-css/week-03/lesson.html">
            
                <a href="../../html-css/week-03/lesson.html">
            
                    
                    Week 3 - Design frameworks, Naming patterns and Forms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../js-core/">
            
                <a href="../../js-core/">
            
                    
                    JavaScript I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../js-core/week-04/lesson.html">
            
                <a href="../../js-core/week-04/lesson.html">
            
                    
                    Week 4 - Hello JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../js-core/week-05/lesson.html">
            
                <a href="../../js-core/week-05/lesson.html">
            
                    
                    Week 5 - Conditionals and Arrays
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../js-core/week-06/lesson.html">
            
                <a href="../../js-core/week-06/lesson.html">
            
                    
                    Week 6 - More Arrays
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../js-core-2/">
            
                <a href="../../js-core-2/">
            
                    
                    JavaScript II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../js-core-2/week-07/lesson.html">
            
                <a href="../../js-core-2/week-07/lesson.html">
            
                    
                    Week 7 - Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../js-core-2/week-08/lesson.html">
            
                <a href="../../js-core-2/week-08/lesson.html">
            
                    
                    Week 8 - JS in the Browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../js-core-2/week-09/lesson.html">
            
                <a href="../../js-core-2/week-09/lesson.html">
            
                    
                    Week 9 - More JS in the Browser
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../js-core-3/">
            
                <a href="../../js-core-3/">
            
                    
                    JavaScript III
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../js-core-3/week-10/lesson.html">
            
                <a href="../../js-core-3/week-10/lesson.html">
            
                    
                    Week 10 - Unit Tests and TDD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../js-core-3/week-11/lesson.html">
            
                <a href="../../js-core-3/week-11/lesson.html">
            
                    
                    Week 11 - More TDD, ES6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../js-core-3/week-12/lesson.html">
            
                <a href="../../js-core-3/week-12/lesson.html">
            
                    
                    Week 12 - Recap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../">
            
                <a href="../">
            
                    
                    Node/DB I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../week-13/lesson.html">
            
                <a href="../week-13/lesson.html">
            
                    
                    Week 13 - Node and Express 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../week-14/lesson.html">
            
                <a href="../week-14/lesson.html">
            
                    
                    Week 14 - Middleware, Templating and APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../week-15/lesson.html">
            
                <a href="../week-15/lesson.html">
            
                    
                    Week 15 - Advanced Node
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../">
            
                <a href="../">
            
                    
                    Node/DB II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../week-16/lesson.html">
            
                <a href="../week-16/lesson.html">
            
                    
                    Week 16 - Basic SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../week-17/lesson.html">
            
                <a href="../week-17/lesson.html">
            
                    
                    Week 17 - SQL with Node
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.3" data-path="lesson.html">
            
                <a href="lesson.html">
            
                    
                    Week 18 - Data Integrity & Analytics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../react/">
            
                <a href="../../react/">
            
                    
                    React
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../react/week-19/lesson.html">
            
                <a href="../../react/week-19/lesson.html">
            
                    
                    Week 19 - React 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../../react/week-20/lesson.html">
            
                <a href="../../react/week-20/lesson.html">
            
                    
                    Week 20 - Reacting to Changes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../../react/week-21/lesson.html">
            
                <a href="../../react/week-21/lesson.html">
            
                    
                    Week 21 - Fetching Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Useful information</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../conduct.html">
            
                <a href="../../conduct.html">
            
                    
                    Code of Conduct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../useful-links.html">
            
                <a href="../../useful-links.html">
            
                    
                    Useful links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../PRACTICES.html">
            
                <a href="../../PRACTICES.html">
            
                    
                    Coding Standards and Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../others/making-a-pull-request.html">
            
                <a href="../../others/making-a-pull-request.html">
            
                    
                    Making a Pull Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../others/cors.html">
            
                <a href="../../others/cors.html">
            
                    
                    CORS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../others/useful-tools.html">
            
                <a href="../../others/useful-tools.html">
            
                    
                    Useful Tools
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Workshops and other resources</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../others/coding-101.html">
            
                <a href="../../others/coding-101.html">
            
                    
                    Coding 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../html-css/compile-scss-instructions.html">
            
                <a href="../../html-css/compile-scss-instructions.html">
            
                    
                    Compiling SCSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../week-13/workshop.html">
            
                <a href="../week-13/workshop.html">
            
                    
                    Express Workshop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../week-15/workshop.html">
            
                <a href="../week-15/workshop.html">
            
                    
                    Hotel Workshop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../others/mongodb-101.html">
            
                <a href="../../others/mongodb-101.html">
            
                    
                    MongoDB 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../others/aws-workshop-2.html">
            
                <a href="../../others/aws-workshop-2.html">
            
                    
                    AWS - DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" >
            
                <a target="_blank" href="https://github.com/Thomas-Stewart/syllabus/tree/master/java">
            
                    
                    Java module
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">For Mentors</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../CONTRIBUTING.html">
            
                <a href="../../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../others/lesson-template.html">
            
                <a href="../../others/lesson-template.html">
            
                    
                    Lesson Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <span>
            
                    
                    HTML/CSS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../../html-css/mentor-guide.html">
            
                <a href="../../html-css/mentor-guide.html">
            
                    
                    Mentors guide
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                    JavaScript I
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="../../js-core/week-04/mentors.html">
            
                <a href="../../js-core/week-04/mentors.html">
            
                    
                    Week 4 - Hello JavaScript
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Week 18 - Data Integrity & Analytics</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="lesson-3-data-integrity-and-analytics">LESSON 3: DATA INTEGRITY AND ANALYTICS</h1>
<p><strong>Recap of last lesson</strong></p>
<ul>
<li>What is the difference between user story, use case and user acceptance test.</li>
<li>How to run a database query that retrieves tabular data in node express to an endpoint.</li>
<li>Inserting data from an endpoint using postman.</li>
<li>Updating data from an endpoint using postman.</li>
<li>Using &apos;IN&apos;</li>
<li>Deleting data</li>
</ul>
<p><strong>What we will learn today?</strong></p>
<ul>
<li>Joins</li>
<li>SQL Injection</li>
<li>LIMIT</li>
<li>DISTINCT</li>
<li>SUM / AVG / COUNT</li>
<li>GROUP BY</li>
<li>HAVING</li>
</ul>
<h3 id="lesson-1-join-me-and-together-we-can-rule-the-galaxy-as-father-and-son">LESSON 1: JOIN ME, AND TOGETHER WE CAN RULE THE GALAXY AS FATHER AND SON!</h3>
<p>So far, we&apos;ve put data in tables and kept references to each of them using IDs, but
we&apos;ve not yet learned how to link them automatically.</p>
<p>We don&apos;t know how to get the <em>name</em> of a customer from a reservation - only their ID.</p>
<p>Now let&apos;s say we want to get the <em>names</em> of customers who have a reservation <em>today</em>.</p>
<p>From what we know now, we <em>could</em> do it like this:</p>
<ul>
<li><code>SELECT customer_id FROM reservations WHERE check_in_date = &apos;2018/08/19&apos;;</code></li>
<li>write down the list of customer IDs on paper (e.g. 3, 5, 7)</li>
<li><code>SELECT * FROM customers WHERE id IN (3, 5, 7);</code></li>
</ul>
<p>However, we want the computer to figure out that we want IDs 3, 5 and 7 by itself.</p>
<p>This is what a database &quot;JOIN&quot; is. In real life, if you work with databases, you will be using this thing <em>all</em> of the time - relationships between data are vitally important.</p>
<p>Now, we have data that spans two tables - we have reservations with a &quot;customer_id&quot; column that refers to the ID column in the &quot;customers&quot; table.</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> reservations<span class="token punctuation">.</span>check_in_date<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">=</span> <span class="token string">&apos;2018/08/19&apos;</span><span class="token punctuation">;</span>
</code></pre>
<p>Note that:</p>
<ul>
<li>Because we are selecting columns from two tables and need to distinguish them, we use &quot;table.column&quot; syntax.</li>
<li>We explicitly link reservations.customer_id and customers.id <em>even if they have a foreign key relationship</em>.</li>
<li>reservations.customer_id and customers.id don&apos;t actually <em>have</em> to have a foreign key relationship, but they should.</li>
</ul>
<p>Let&apos;s try the query.</p>
<p>First, go to the <code>cyf-hotel-db</code> repo in your terminal and switch to the <code>class3</code> branch. Next, run <code>npm i</code> and <code>npm start</code> to start the server. Then, open a new terminal tab in the <code>cyf-hotel-db</code> directory and run <code>sqlite3 database/database.sqlite</code> to open SQLite.</p>
<p>Now, copy and paste the above <code>SELECT</code> query into SQLite. You should get this:</p>
<pre class="language-"><code>2018/08/19|Marie|Niki
2018/08/19|Anna|Kolen
</code></pre><h5 id="exercise-1a">EXERCISE 1.a</h5>
<p>Get the list of all room IDs together with their room type names.</p>
<h5 id="exercise-1b-optional-stretch-goal">EXERCISE 1.b: OPTIONAL STRETCH GOAL</h5>
<p>Get the list of reservations (all columns) together with the the title, first name and surname customer who made it.</p>
<h3 id="lesson-2-sql-injection">LESSON 2: SQL INJECTION</h3>
<p>So, our hotel has a shady new guest. Let&apos;s say that we have a react frontend on top which uses the
APIs we&apos;re building - users won&apos;t use the APIs directly but they can just fire up postman and use them
if they want.</p>
<p>This is very common - lots of websites have a single page application that uses an API underneath just like the one
we&apos;re building.</p>
<p>Now, this guest does a little poking around and he realizes that he can delete his reservation.</p>
<pre class="language-"><code>DELETE http://localhost:8080/api/reservations/6
</code></pre><p>Now, open a new terminal window and run &quot;sqlite3 databases/database.sqlite&quot;:</p>
<pre class="language-"><code>sqlite&gt; SELECT * FROM reservations;
</code></pre><p>The reservation with ID 6 should be deleted - as you coded it to work.</p>
<p>This is fine, but not very interesting. However, let&apos;s experiment - try doing <em>this</em> with your reservation API:</p>
<pre class="language-"><code>DELETE http://localhost:8080/api/reservations/6%20or%201%3D1
</code></pre><p>And run this again:</p>
<pre class="language-"><code>sqlite&gt; SELECT * FROM reservations;
</code></pre><p>And voila, he&apos;s just emptied out the entire hotel. Nobody has a reservation any more!</p>
<p><img src="hackerman.jpg" alt="Hackerman" title="Hackerman"></p>
<h5 id="exercise-2a">EXERCISE 2.a</h5>
<p>You have five minutes. Work in teams. Figure out what happened between you and <em>why</em>.</p>
<p>Clue : You might want to use this <a href="https://meyerweb.com/eric/tools/dencoder/" target="_blank">https://meyerweb.com/eric/tools/dencoder/</a></p>
<h3 id="lesson-3-order-by-something">LESSON 3: ORDER BY SOMETHING</h3>
<p>QUESTION FOR CLASS : What the difference is between <em>random</em> and <em>arbitrary</em>?</p>
<p>Up until now we&apos;ve not been returning results in a <em>random</em> order, but we have been returning
them in an <em>arbitrary</em> order. The database has chosen what order to return records in. It&apos;s
generally the order you put them in but there is <em>no</em> guarantee it will be in that order.</p>
<p>Using &apos;order by&apos; we can get records back in a specified order:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> reservations<span class="token punctuation">.</span>check_in_date<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">=</span> <span class="token string">&apos;2018/08/19&apos;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>surname<span class="token punctuation">;</span>
</code></pre>
<p>This will give the output in a new order:</p>
<pre class="language-"><code>2018/08/19|Anna|Kolen
2018/08/19|Marie|Niki
</code></pre><p>We have Mrs Clinton, Mr Trump and Mr Hackerman staying at the hotel. What order will the reservations be displayed in?</p>
<p>If we want to get <em>explicitly</em> the three of them in ascending order:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> reservations<span class="token punctuation">.</span>check_in_date<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">=</span> <span class="token string">&apos;2018/08/19&apos;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>surname <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre>
<p>Now, if we want them in descending order:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> reservations<span class="token punctuation">.</span>check_in_date<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">=</span> <span class="token string">&apos;2018/08/19&apos;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>surname <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-"><code>Check In Date  First Name  Surname
------------------------------------
2018/08/19     Melania     Trump
2018/08/19     Donald      Trump
2018/08/19     Colm        Hackerman
2018/08/19     Bill        Clinton
2018/08/19     Hillary     Clinton
</code></pre><p>This is just one way the results could come out. They could also come out (e.g. on a different computer, or done at a different time), for instance, like this:</p>
<pre class="language-"><code>Check In Date  First Name  Surname
------------------------------------
2018/08/19     Donald      Trump
2018/08/19     Melania     Trump
2018/08/19     Colm        Hackerman
2018/08/19     Hillary     Clinton
2018/08/19     Bill        Clinton
</code></pre><p>Note that Donald and Melania and Bill and Hillary are both reversed this time. This is because we said to sort by surname, which it does, but there are no guarantees about what order rows appear in where the surname is the same.</p>
<p>So, if we want to make it more <em>deterministic</em> (opposite of arbitrary), we can make it sort by surname <em>first</em> and first name <em>second</em>:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> reservations<span class="token punctuation">.</span>check_in_date<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">=</span> <span class="token string">&apos;2018/08/19&apos;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>surname <span class="token keyword">DESC</span><span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-"><code>Check In Date  First Name  Surname
------------------------------------
2018/08/19     Donald      Trump
2018/08/19     Melania     Trump
2018/08/19     Colm        Hackerman
2018/08/19     Bill        Clinton
2018/08/19     Hillary     Clinton
</code></pre><p>In this case, since we&apos;re ordering by first name ascending, Donald always comes before Melania (D comes before M in the alphabet) and Bill comes before Hillary (because B comes before H in the alphabet).</p>
<h3 id="lesson-4-limit-your-queries">LESSON 4: LIMIT YOUR QUERIES</h3>
<p>Now, the database you&apos;re working with right now is essentially just a toy. However,
when you work with a real database you&apos;re often going to have a number of problems</p>
<p>1) SELECT * FROM table is going to return thousands of rows. This take ages
to load and display and if you just want to see a representative sample it&apos;s overkill.</p>
<p>2) You want to return the top 10 of something.</p>
<p>3) You want to show results 1-10 on page 1, results 2-20 on page 2, etc.</p>
<p>SQL has a keyword called &quot;LIMIT&quot; which you can put at the end of a query to cut down
on the number of returned rows:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> surname <span class="token keyword">ASC</span> <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="exercise-4a">EXERCISE 4.a</h5>
<p>Select two rooms only.</p>
<h5 id="exercise-4b-optional-stretch-goal">Exercise 4.b: OPTIONAL STRETCH GOAL</h5>
<p>Select the latest 5 reservations on the database.</p>
<h5 id="exercise-4c-optional-stretch-goal">Exercise 4.c: OPTIONAL STRETCH GOAL</h5>
<p>Select the reservations, primarily selecting the most recent ones, and secondarily selecting the longest ones.</p>
<h3 id="lesson-5-distinct">LESSON 5: DISTINCT</h3>
<p>Remember the JOIN query from above? We&apos;re going to do another similar one.</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">&gt;</span> <span class="token string">&apos;2017/12/31&apos;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>surname <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre>
<p>QUESTION FOR CLASS : What does this do?</p>
<p>ANS : Get a list of all customers who have a reservation that begins this year</p>
<p>Now, this is going to work with one exception. The list in my database
is going to look a bit like this:</p>
<pre class="language-"><code>First Name  Surname
---------------------
Hillary     Clinton
Colm        Hackerman
Colm        Hackerman
Colm        Hackerman
Donald      Trump
</code></pre><p>QUESTION FOR CLASS : Why?</p>
<p>ANS : Because Mr Hackerman loves this hotel more than Hillary and Donald and has arranged to stay there a few times.</p>
<p>Of course, we only want to know <em>IF</em> Hackerman has stayed there once, not that he&apos;s their most popular guest.</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>surname
<span class="token keyword">FROM</span> reservations <span class="token keyword">JOIN</span> customers <span class="token keyword">ON</span> reservations<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> reservations<span class="token punctuation">.</span>check_in_date <span class="token operator">&gt;</span> <span class="token string">&apos;2017/12/31&apos;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>surname <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre>
<p>Will output:</p>
<pre class="language-"><code>First Name  Surname
---------------------
Hillary     Clinton
Colm        Hackerman
Donald      Trump
</code></pre><p>Problem solved.</p>
<h5 id="exercise-5a">EXERCISE 5.a</h5>
<p>Get the list of check in dates in the summer 2017.</p>
<h5 id="exercise-5b-optional-stretch-goal">EXERCISE 5.b: OPTIONAL STRETCH GOAL</h5>
<p>Get the list of customers that made a reservation in the last year, including their details.</p>
<h3 id="lesson-6-sum-average-and-count">LESSON 6: SUM, AVERAGE AND COUNT</h3>
<p>Let us imagine that we want to know how many reservations we have on our database. Similarly to the previous lesson, we could get all the records and count them ourselves, but that sounds boring and unrealistic in real life cases, where databases can have several millions of entries. So, for that purpose we have aggregation functions:</p>
<pre class="language-"><code>COUNT, SUM or AVG
</code></pre><p>The usages of each are pretty obvious.
So, this means that we can count, sum and calculate the average of a set of values.</p>
<p>Let&apos;s check an example for <code>COUNT</code>:</p>
<p><code>SELECT COUNT(*) FROM customers;</code></p>
<p>This will return the number of customers on a database.</p>
<p>We call these aggregation functions, and we use them to modify the results while aggregating the table results - we had a list of rows for customers, now we have the count of customers: we aggregated the rows by counting them.</p>
<h5 id="exercise-6a">EXERCISE 6.a</h5>
<p>COUNT the number of reservations for a given customer ID.</p>
<h5 id="exercise-6b-optional-stretch-goal">EXERCISE 6.b: OPTIONAL STRETCH GOAL</h5>
<p>Calculate the average paid amount across all invoices.</p>
<h3 id="lesson-7-grouping">LESSON 7: GROUPING</h3>
<p>Let us say that we need to get the list of different surnames from our list of customers, and how many times each surname shows up on our database.</p>
<p>Here the idea is that we could group the columns by the surname and get a list of each different surname, and then we can apply an aggregation function to them.</p>
<p>For this we can use <code>GROUP BY</code> as follows:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> <span class="token operator">&lt;</span>column_to_aggregate_1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>column_to_aggregate_2<span class="token operator">&gt;</span> <span class="token keyword">FROM</span> <span class="token operator">&lt;</span><span class="token keyword">table</span><span class="token operator">&gt;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>column_to_aggregate_1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>column_to_aggregate_2<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre>
<p>For instance, if we have the following entries on the customers:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>title</th>
<th>first_name</th>
<th>surname</th>
<th>email</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Doc.</td>
<td>Tom</td>
<td>Jones</td>
<td>tom.jones@domain.com</td>
</tr>
<tr>
<td>2</td>
<td>Mr.</td>
<td>Jorge</td>
<td>Silva</td>
<td>jorge-silva@domain.com</td>
</tr>
<tr>
<td>3</td>
<td>Mr.</td>
<td>Jorge</td>
<td>Silva</td>
<td>jorge2-silva@domain.com</td>
</tr>
<tr>
<td>16</td>
<td>Doc.</td>
<td>Pedro</td>
<td>Silva</td>
<td>pedro.silva@domain.com</td>
</tr>
<tr>
<td>17</td>
<td>Doc.</td>
<td>Colm</td>
<td>O&apos;Conner</td>
<td>colm.oconner@domain.com</td>
</tr>
<tr>
<td>18</td>
<td>Doc.</td>
<td>James</td>
<td>Lennon</td>
<td>john.lennon@domain.com</td>
</tr>
<tr>
<td>19</td>
<td>Sir.</td>
<td>John</td>
<td>O&apos;Conner</td>
<td>John.oconner@domain.com</td>
</tr>
</tbody>
</table>
<p>If we group by surname we have 4 different surnames: <code>O&apos;Conner</code>, <code>Silva</code>, <code>Jones</code>, <code>Lennon</code>, but for <code>Silva</code> and <code>O&apos;Conner</code>, we have more than one entry, so we need to aggregate them. In this case, we want to count the occurrences so we can simply do:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> surname<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> customers <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> surname<span class="token punctuation">;</span>
</code></pre>
<p>This should give this output:</p>
<pre class="language-"><code>Jones|1
Silva|3
O&apos;Conner|2
Lennon|1
</code></pre><h5 id="exercise-7a">EXERCISE 7.a</h5>
<p>COUNT the occurrences of the DIFFERENT titles on the database.</p>
<h5 id="exercise-7b-optional-stretch-goal">EXERCISE 7.b: OPTIONAL STRETCH GOAL</h5>
<p>COUNT the occurrences of a combination of first-name and surname to get a list of customers with the same name.</p>
<h3 id="lesson-8-having-your-table-and-eating-it">LESSON 8: HAVING YOUR TABLE AND EATING IT</h3>
<p>Suppose that we want to filter the result of what we got on the previous example - count of each customer&apos;s surname - to select only the surnames for which there are 3 or more customers?</p>
<p>To accomplish that we can use <code>HAVING</code> as follows:</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">SELECT</span> surname<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> count <span class="token keyword">FROM</span> customers <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> surname <span class="token keyword">HAVING</span> count <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre>
<p>Note that <code>WHERE</code> would not work, because it enables us to filter data that will grouped, and we want to filter the result of that grouping. We want to filter by the count of customers.</p>
<h5 id="exercise-8a">EXERCISE 8.a</h5>
<p>Get the list of customers that have 5 or more reservations on our hotel.</p>
<h1 id="homework">HOMEWORK</h1>
<h5 id="homework-1">HOMEWORK 1</h5>
<p><strong>User Story:</strong> As a staff member, I want to see reservations and their respective invoices</p>
<p>Create an endpoint to get from <code>/reservations-and-invoices/</code> the list of reservations and respective invoices.</p>
<h5 id="homework-2">HOMEWORK 2</h5>
<p>Calculate the total amount paid on invoices for the summer of 2017.</p>
<h5 id="homework-3">HOMEWORK 3</h5>
<p><strong>User Story:</strong> As a staff member, I want to check the number reservations for each customer, including their own details, so that we check who are our best customers.</p>
<p>Complete the endpoint to get from <code>/reservations-per-customer/</code> the number of reservations per customer, with details for the customer and the reservation.</p>
<h5 id="homework-4">HOMEWORK 4</h5>
<p>Get the number of reservations for each room ID and include the details for the room details.</p>
<h5 id="homework-5">HOMEWORK 5</h5>
<p>Adapt the previous query (8.c) to include the details for the type of room.</p>
<h5 id="homework-6">HOMEWORK 6</h5>
<p>Get the list of rooms with sea view that were reserved more than 5 times.</p>
<h5 id="homework-7">HOMEWORK 7</h5>
<p>Create an endpoint for each previous exercise that doesn&apos;t have an endpoint yet. You will have to think about what is the context of the query, what parameters you need to receive in the end-point and what makes sense to return as a result and in which format.</p>
<h5 id="homework-8">HOMEWORK 8</h5>
<p><strong>User Story</strong> As a staff member, I want to get the list of reservations within a time period, including the room and customer details.</p>
<p>Create an endpoint to get from <code>/reservations/details-between/:from_day/:to_day</code> the list of reservations between a specified time period. this should include the customer and room details.</p>
<h5 id="homework-9">HOMEWORK 9</h5>
<p><strong>User Story</strong> As a staff member, I want to get the number of reservations per customer.</p>
<p>Create an endpoint to get from <code>/reservations-per-customer/</code> the number of reservations each client has.</p>
<h6 id="homework-10">HOMEWORK 10</h6>
<p><strong>User Story</strong> As a staff member I want to analyse the rentability of each room, getting the total amount earned for each room, the average per reservations, and the number of reservations it has had in the past.</p>
<p>Create an endpoint to get from <code>/stats-price-room/</code> the list of rooms, together with the amount the hotel has earned with each, the average value earned per stay, and the number of complete stays it has had in the past.</p>
<h5 id="homework-11">HOMEWORK 11</h5>
<p><strong>User Story</strong> As a client or staff member, I want to check the availability of a room within a given date range.</p>
<p>Create an endpoint to get from <code>/rooms/available-in/:from_day/:to_day</code> the list of available rooms.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../week-17/lesson.html" class="navigation navigation-prev " aria-label="Previous page: Week 17 - SQL with Node">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../react/" class="navigation navigation-next " aria-label="Next page: React">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Week 18 - Data Integrity & Analytics","level":"1.8.3","depth":2,"next":{"title":"React","level":"1.9","depth":1,"path":"react/index.md","ref":"react/index.md","articles":[{"title":"Week 19 - React 101","level":"1.9.1","depth":2,"path":"react/week-19/lesson.md","ref":"react/week-19/lesson.md","articles":[]},{"title":"Week 20 - Reacting to Changes","level":"1.9.2","depth":2,"path":"react/week-20/lesson.md","ref":"react/week-20/lesson.md","articles":[]},{"title":"Week 21 - Fetching Data","level":"1.9.3","depth":2,"path":"react/week-21/lesson.md","ref":"react/week-21/lesson.md","articles":[]}]},"previous":{"title":"Week 17 - SQL with Node","level":"1.8.2","depth":2,"path":"node-db/week-17/lesson.md","ref":"node-db/week-17/lesson.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["prism","-highlight","todo","scripts"],"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"scripts":{"files":["./checkboxRemember.js"]},"todo":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"node-db/week-18/lesson.md","mtime":"2019-03-16T12:19:04.344Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-16T12:20:14.073Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-scripts/c7a8b0876428f8ec3c1b5735174e535d-checkboxRemember.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

